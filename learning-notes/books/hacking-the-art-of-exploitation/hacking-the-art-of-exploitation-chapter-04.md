**SUMMARY OF** 
**HACKERS: THE ART OF EXPLOITATION** 
*(SECOND EDITION) BY JON ERICKSON*

---

# 0x400. NETWORKING

---

## 0x410. OSI Model

* **Purpose**: a 7-layer mental model that cleanly separates concerns so hardware (switches/routers/firewalls) can focus on their layer while apps focus on theirs. :contentReference[oaicite:1]{index=1}  
* **Layers (high-altitude view)**  
  1. **Physical** – raw bits over a medium (voltages/radio/optics). :contentReference[oaicite:2]{index=2}  
  2. **Data-Link** – framing & MAC addressing; local delivery on a segment.  
  3. **Network** – logical addressing & routing (IP).  
  4. **Transport** – end-to-end delivery & ports (TCP/UDP).  
  5. **Session** – conversations (establish/teardown).  
  6. **Presentation** – representation/encoding (TLS, ASN.1, MIME).  
  7. **Application** – protocols apps speak (HTTP, SMTP, DNS).  
* **Key insight**: protocols encapsulate—each layer wraps the higher layer’s payload; tools and attacks often “peel” these layers.

---

## 0x420. Sockets

* **Abstraction**: a *socket* is an endpoint the OS exposes so programs can send/receive data without micromanaging all OSI layers. :contentReference[oaicite:3]{index=3}  
* **Stream sockets (TCP)**: reliable, ordered, bidirectional, connection-oriented—think phone call; used by HTTP/SMTP/IMAP/etc. :contentReference[oaicite:4]{index=4}  
* **Datagram sockets (UDP)**: fire-and-forget, unordered, no built-in reliability—fast and lightweight; you add acks/retries if needed. :contentReference[oaicite:5]{index=5}  

### 0x421. Socket Functions

* **Server steps**: `socket()` → `bind()` (address/port) → `listen()` (queue) → loop `accept()` → `read()/write()` → `close()`.  
* **Client steps**: `socket()` → `connect()` → `read()/write()` → `close()`.  
* **Options**: `setsockopt()` for `SO_REUSEADDR` (rebinding), timeouts, buffer sizes.  
* **Mindset**: treat FDs as files; syscalls return bytes read/written or `-1` with `errno`.

### 0x422. Socket Addresses

* **`sockaddr_in` (IPv4)**: family (`AF_INET`), port (`sin_port`), address (`sin_addr`).  
* **Network order**: multi-byte integers are big-endian on the wire (see next section).  
* **Binding**: `INADDR_ANY` listens on all local interfaces; otherwise bind a specific IP.

### 0x423. Network Byte Order

* **Big vs little**: hosts may be little-endian (x86), but the network standard is **big-endian**.  
* **Helpers**: `htons/htonl` and `ntohs/ntohl` convert host↔network for ports/addresses.

### 0x424. Internet Address Conversion

* **Text↔binary**: `inet_pton(AF_INET, "1.2.3.4", &addr)` and `inet_ntop(...)` replace older `inet_aton/inet_ntoa`.  
* **Validation**: conversions are your chance to reject malformed input early.

### 0x425. A Simple Server Example

* **Blocking echo** (sketch):  
  1) create/bind/listen on `AF_INET/SOCK_STREAM`;  
  2) `accept()` a client;  
  3) `read()` bytes and immediately `write()` them back;  
  4) close the client FD; loop.  
* **Teaching goals**: show the lifecycle, error paths, and how a single-threaded server serializes clients.

### 0x426. A Web Client Example

* **HTTP GET** flow**:** resolve host → `socket()`/`connect()` to port 80 → send minimal request lines with `\r\n` CRLF → read until EOF.  
* **Headers vs body**: read lines until the blank line; then handle content length or chunked transfer.

### 0x427. A Tinyweb Server

* **Minimal HTTP/1.0**: parse `GET /path HTTP/1.0`, map to filesystem, serve static file with headers.  
* **Why hackers care**: tiny parsers make great labs—off-by-one, path traversal, or format bugs become concrete.

---

## 0x430. Peeling Back the Lower Layers

### 0x431. Data-Link Layer

* **Ethernet framing**: dest/src MAC + EtherType + payload + FCS; ARP resolves IP→MAC.  
* **Switch behavior**: learns MAC⇄port; floods unknown/unicast until learned.

### 0x432. Network Layer

* **IP**: header (ver, IHL, TTL, proto, src/dst); fragmentation basics; ICMP for control (echo, time-exceeded).  
* **Routing**: longest-prefix match; default gateways forward beyond the local subnet.

### 0x433. Transport Layer

* **TCP**: 3-way handshake, sequence/ack numbers, sliding window, retransmits; flags (SYN/ACK/FIN/RST/PSH/URG).  
* **UDP**: stateless, checksum optional in v4—sniffers/IDSs treat it differently.

---

## 0x440. Network Sniffing

### 0x441. Raw Socket Sniffer

* **Raw capture**: privileged sockets read IP packets and parse headers manually—portable enough for experiments.  
* **Limits**: platform permissions and link-layer access vary.

### 0x442. libpcap Sniffer

* **API**: `pcap_open_live`, compile/apply BPF filter, `pcap_loop` callback.  
* **Why use pcap**: portable, fast (kernel-level filtering), well-supported.

### 0x443. Decoding the Layers

* **Dissection pipeline**: Ethernet → IP → TCP/UDP → app data; check header lengths, checksums, and payload bounds at each hop.  
* **Practice**: reconstruct HTTP requests/responses to see end-to-end behavior.

### 0x444. Active Sniffing

* **MITM on a switched LAN**: ARP spoofing/poisoning to intercept traffic; MAC flooding to force hub-like behavior.  
* **Ethics & safety**: isolate to your lab network; logging + restores afterward.

---

## 0x450. Denial of Service

* **Theme**: exhaust *some* finite resource—bandwidth, kernel queues, memory, CPU, state tables—until service fails or degrades.

### 0x451. SYN Flooding

* **Half-open storms**: spoofed SYNs fill the server’s SYN backlog so legit handshakes starve; SYN cookies mitigate.

### 0x452. The Ping of Death

* **Legacy bug**: oversized/fragmented ICMP echo packets crashed old IP stacks; fixed today but instructive about parser limits.

### 0x453. Teardrop

* **Fragment overlap**: malicious IP fragments with overlapping offsets confused reassembly code → crashes on older kernels.

### 0x454. Ping Flooding

* **ICMP rate pressure**: many pings saturate CPU or links; trivial but demonstrates bandwidth vs. host processing ceilings.

### 0x455. Amplification Attacks

* **Reflectors**: small spoofed request → large response (e.g., DNS, NTP) to a victim; leverage many open reflectors for scale.

### 0x456. Distributed DoS Flooding

* **Botnets**: many sources coordinate floods; defenses rely on upstream filtering, scrubbing centers, and anycast/CDN capacity.

---

## 0x460. TCP/IP Hijacking

* **Idea**: inject packets into an existing flow by predicting 4-tuple (src/dst IP:port) and sequence/ack numbers; blind vs. in-path.

### 0x461. RST Hijacking

* **Desync via RST**: send a forged `RST` with in-window sequence to kill a TCP session (e.g., censorship/reset tricks).

### 0x462. Continued Hijacking

* **Maintain control**: once injected, keep sending in-window data/acks so the legitimate endpoint’s packets are ignored or arrive out-of-window.

---

## 0x470. Port Scanning

* **Recon 101**: discover open ports/services, versions, and firewall rules; rate/stealth tradeoffs matter for evasion.

### 0x471. Stealth SYN Scan

* **Half-open**: send SYN, see SYN-ACK (open) or RST (closed), then immediately RST to avoid full handshake/logging.

### 0x472. FIN, X-mas, and Null Scans

* **Weird flags**: send FIN (or FIN+PSH+URG “X-mas”) or no flags; RFC-compliant closed ports send RST, open ports ignore—firewalls vary.

### 0x473. Spoofing Decoys

* **Camouflage**: mix real probes among spoofed sources so logs implicate decoys; watch for IDS heuristics that spot patterns.

### 0x474. Idle Scanning

* **Zombie IPID**: use a quiet host’s IPID increments to infer whether your spoofed SYNs elicited SYN-ACKs—fully blind target scan.

### 0x475. Proactive Defense (shroud)

* **Noise & misdirection**: tarpits, fake services/banners, and randomized stacks make scanning costlier and less reliable.

---

## 0x480. Reach Out and Hack Someone

* **From local PoC to remote exploit**: stitch networking with exploitation—deliver payload over sockets, control return paths, and verify effects remotely. :contentReference[oaicite:6]{index=6}

### 0x481. Analysis with GDB

* **Remote repro**: run targets under `gdb`, attach to daemons, and inspect crashes produced by network inputs; capture core files for offline triage.

### 0x482. Almost Only Counts with Hand Grenades

* **Reliability work**: tighten offsets, remove bad characters, stabilize addresses (env sizing/argv padding), and account for latency/packet loss—“almost” landing a jump isn’t enough in the wild.

### 0x483. PortBinding Shellcode

* **Concept**: payload opens a listening socket on a known port and dup2’s STDIN/OUT/ERR to the connected socket; the attacker then `telnet`s in for a shell.  
* **Tradeoffs**: simple and firewall-friendly on egress-blocked networks; but network defenders can notice unexpected listening ports.

---

## Summary author: **Jeremy Ray Jewell**  
[GitHub](https://github.com/jeremyrayjewell)  
[LinkedIn](https://www.linkedin.com/in/jeremyrayjewell)
