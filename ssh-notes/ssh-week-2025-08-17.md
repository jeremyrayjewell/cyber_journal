# SSH Notes: Week of 2025-08-17
**Theme:** Client-side Algorithm Negotiation (no server changes; knock required)

## 1) Results
| Profile / Test         | Outcome  | KEX (negotiated)           | HostKey       | C2S cipher                 | S2C cipher                 | Logfile                  |
|------------------------|----------|----------------------------|---------------|----------------------------|----------------------------|--------------------------|
| forced-mlkem           | Success  | `mlkem768x25519-sha256`    | `ssh-ed25519` | chacha20-poly1305@openssh.com | chacha20-poly1305@openssh.com | `forced-mlkem.log`       |
| forced-curve25519      | Success  | `curve25519-sha256`        | `ssh-ed25519` | chacha20-poly1305@openssh.com | chacha20-poly1305@openssh.com | `forced-curve25519.log`  |
| forced-dh14            | Success* | *(parser didn’t capture)*  | *(parser n/a)*| *(parser n/a)*             | *(parser n/a)*             | `forced-dh14.log`        |

\* Success shown because the remote command ran (printed `READY`). The parser didn’t recognize the KEX line for this run; practical takeaway: the server accepted the client’s DH14 proposal, which implies **DH14 is enabled** server-side. We’ll harden that when admin access is restored.

## 2) Raw Command Log
```bash
# All runs require opening the port first:
knock 192.168.1.12 1111 2222 3333

# Hybrid PQ (expected success if supported)
ssh -vvv -o ConnectTimeout=5 -o KexAlgorithms=mlkem768x25519-sha256 \
  kali@192.168.1.12 'echo READY; exit' \
  2>&1 | tee ~/ssh-logs/2025-08-18/forced-mlkem.log

# Classical curve25519 (expected success)
knock 192.168.1.12 1111 2222 3333
ssh -vvv -o ConnectTimeout=5 -o KexAlgorithms=curve25519-sha256 \
  kali@192.168.1.12 'echo READY; exit' \
  2>&1 | tee ~/ssh-logs/2025-08-18/forced-curve25519.log

# Legacy DH14 (observed success ⇒ DH14 allowed)
knock 192.168.1.12 1111 2222 3333
ssh -vvv -o ConnectTimeout=5 -o KexAlgorithms=diffie-hellman-group14-sha1 \
  kali@192.168.1.12 'echo READY; exit' \
  2>&1 | tee ~/ssh-logs/2025-08-18/forced-dh14.log

## 3) Takeaways

- Server negotiates hybrid PQ (mlkem768x25519-sha256) and classical (curve25519-sha256) cleanly.

- Host key type observed: ssh-ed25519. Symmetric cipher: chacha20-poly1305@openssh.com.

- DH14 (SHA-1–era) appears enabled since a client-forced DH14 session reached the shell. This is acceptable for lab work but should be disabled in production.

## 4) Next Steps (when admin access is restored)

In server profile(s), restrict KEX to modern only (example):

`KexAlgorithms curve25519-sha256,mlkem768x25519-sha256` and omit `diffie-hellman-group14-sha1`.

Re-run the same three client tests; DH14 should then fail (by design), while `mlkem768x25519-sha256` and `curve25519-sha256` continue to succeed.

Keep port-knock in place for stealth; it worked as intended.
